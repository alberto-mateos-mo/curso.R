---
title: De qu√© hablamos cuando hablamos
author: Dave
date: '2021-08-25'
slug: de-que-hablamos
categories:
  - R
tags:
  - Data Cleansing
  - Text Analysis
  - Wordcloud
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="an√°lisis-y-limpeza-de-textos." class="section level1">
<h1>An√°lisis y limpeza de textos.</h1>
<p>Hola Ameyalli üòä, ¬øalguna vez te has preguntado de qu√© hablamos cuando hablamos?, ¬øhabr√° alguna palabra que m√°s utilizas?</p>
<p>Bueno pues en este proyecto analizaremos nuestra conversaci√≥n (que emoci√≥n) para tratar de identificar de qu√© es de lo que m√°s hablamos, si usamos alguna palabra con mayor frecuencia, o bueno realmente buscaremos si sale algo interesante gg.</p>
<p>Antes de pasar al ejercicio te quiero platicar que el an√°lisis de textos tiene muchas aplicaciones, por ejemplo qu√© diran los comentarios de las fotos de IG de una marca, o los comentarios de FB en un post publicitario. Ahora que est√°n de moda los bots, se puede analizar qu√© es lo que le preguntan las personas al bot y usar eso para mejorarlo.</p>
<p>¬øTe ha tocado responder alguna encuesta de satisfacci√≥n de una tienda comercial? Pues te imaginas tener que leer todos los comentarios, uno por uno, para saber de qu√© se queja la gente, que horror; pero justamente podemos usar el an√°lisis de textos para identificar eso de forma r√°pida y casi que sin esfuerzo.</p>
<p>Pero bueno ahora s√≠ vamos al ejercicio.</p>
<div id="creando-el-proyecto" class="section level2">
<h2>Creando el proyecto</h2>
<p>Para empezar abriremos RStudio y vamos a crear un <strong>Proyecto</strong> para trabajar en este proyecto (valga la redundancia). Al crear un proyecto en RStudio lo que haremos ser√° aislar los scripts y documentos del mismo dentro de una carpeta, la idea es que R tenga acceso solo a los elementos de esta carpeta, con ello mantendremos un orden muy claro de nuestro trabajo y evitaremos mezclar proyectos.</p>
<p>Te recomiendo leer un poco m√°s sobre el uso de proyectos en RStudio en <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">esta liga</a>.</p>
<p>Ya que tenemos RStudio abierto, daremos click en la pesta√±a <strong>File</strong> y luego en <strong>New Project</strong>:</p>
<p><img src="/post/2021-08-24-de-que-hablamos_files/new_project.png" /></p>
<p>Una vez hecho eso, se nos desplegar√°n las siguientes opciones:</p>
<p><img src="/post/2021-08-24-de-que-hablamos_files/new_project_options.png" /></p>
<p>Por ahora solo nos centraremos en las opciones <strong>New Directory</strong> y <strong>Existing Directory</strong>.</p>
<p>La primera (<strong>New Directory</strong>) la usaremos cuando a√∫n no hayamos creado una carpeta para nuestro proyecto, la segunda (<strong>Existing DIrectory</strong>) la usar√©mas si es que ya existe una carpeta en nuestros documentos que est√© destinada al proyecto.</p>
<p>En nuestro caso usaremos la primera opci√≥n y enseguida se nos despelagar√°n las siguientes opciones:</p>
<p><img src="/post/2021-08-24-de-que-hablamos_files/new_directory.png" /></p>
<p>Ah√≠ seleccionaremos <strong>New Project</strong> y veremos lo siguiente:</p>
<p><img src="/post/2021-08-24-de-que-hablamos_files/new_directory_options.png" /></p>
<p>En <strong>Directory name</strong> escribiremos el nombre de la carpeta para nuestro proyecto, ah√≠ podemos poner e.g.¬†<em>analisis_chat</em> o alg√∫n otro nombre que te parezca adecuado. Mi recomendaci√≥n es que el nombre est√© escrito en min√∫sculas, sin espacios (en lugar de ellos podemos usar guiones bajos) y sin caracteres especiales (como acentos).</p>
<p>En la opci√≥n <strong>Create project as subdirectory of:</strong> escogeremos la carpeta donde queremos que se cree la carpeta del proyecto (esto seguro se ley√≥ confuso pero creeme que s√≠ tiene sentido üòÖ).</p>
<p>Por ejemplo, tal vez dentro de la carpeta <strong>Mis documentos</strong> de tu computadora tengas una carpeta llamada <strong>curso_R</strong> destinada a este curso, entonces buscaremos y elegiremos justamente la carpeta <strong>curso_R</strong>.</p>
<p>Finalmente damos click en <strong>Create Project</strong>.</p>
</div>
<div id="an√°lizando-nuestro-chat" class="section level2">
<h2>An√°lizando nuestro chat üò±</h2>
<p>Para empezar dale click <a href="https://drive.google.com/file/d/1E0_h9BNbb8v3giLmAxPqJR9JAcXEd4a6/view?usp=sharing">aqu√≠</a> para descargar nuestra conversaci√≥n de whatsapp.</p>
<p>Guarda el archivo en la carpeta que hayas creado en el paso anterior.</p>
<!-- Ahora, hay dos formas en las que puedes seguir los ejercicios, una es continuar leyendo y la otra es descargar y abrir [este script](www.example.org) en RStudio y seguir las instrucciones ah√≠. -->
<div id="prerequisitos" class="section level3">
<h3>Prerequisitos</h3>
<p>Para muchas de las cosas que haremos usaremos <strong>Paquetes de R</strong> que otras personas programaron. Estos paquetes son conjuntos de funciones creadas para darle a R ciertas funciones adicionales, <a href="https://hbctraining.github.io/Intro-to-R-flipped/lessons/04_introR_packages.html">aqu√≠</a> puedes leer un poco m√°s sobre los paquetes de R.</p>
<p>Por ejemplo para hacer gr√°ficas en R nosotros podr√≠amos crear nuestras propias funciones pero eso ser√≠a perder un poco el tiempo pues ya alguien se preocup√≥ por nosotros y dise√±o un paquete que lo hace m√°s sencillo, nosotros solo debemos instalar ese paquete, cargarlo y empezar a usarlo.</p>
<p>Para este proyecto necesitaremos algunos paquetes que nos har√°n la vida m√°s f√°cil para analizar nuestras conversaciones, los paquetes que usaremos son:</p>
<ul>
<li><p>Tidyverse: Este es un paquete que contiene otros paquetes dise√±ados espec√≠ficamente para tareas de <em>Data Science</em> (m√°s sobre este ecos√≠stema <a href="https://www.tidyverse.org/">aqu√≠</a>).</p></li>
<li><p>tm: Este paquete se usa para tareas de miner√≠a de texto (de ah√≠ su nombre, Text Mining), <a href="https://cran.r-project.org/web/packages/tm/vignettes/tm.pdf">por ac√°</a> hay una introducci√≥n no muy amena pero interesante.</p></li>
<li><p>wordcloud: Este paquete lo usaremos para crear unos gr√°ficos llamados nubes de palabras, como el nombre nos dice son gr√°ficos que nos mostrar√°n palabras, <a href="http://blog.fellstat.com/?cat=11">aqu√≠</a> puedes ver algunos ejemplos.</p></li>
</ul>
<p>Para instalar esos paquetes copiaremos y pegaremos lo siguiente en la consola de R y le daremos enter:</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;) ## Esta instaci√≥n tarda un poco, se paciente :)</code></pre>
<pre class="r"><code>install.packages(&quot;tm&quot;) ## Esta instaci√≥n tarda un poco, se paciente :)</code></pre>
<pre class="r"><code>install.packages(&quot;wordcloud&quot;) ## Esta instaci√≥n tarda un poco, se paciente :)</code></pre>
</div>
<div id="leyendo-el-archivo-en-r" class="section level3">
<h3>Leyendo el archivo en R</h3>
<p>Antes de cualquier cosa lo primero que tenemos poner en nuestro script son los paquetes que usaremos en el an√°lisis:</p>
<pre class="r"><code>library(dplyr) ## Este paquete no lo instalamos directamente pero se instal√≥ al instalar el paquete tidyverse
library(tm)
library(wordcloud)</code></pre>
<p>Muy bien continuemos‚Ä¶</p>
<p>Para lo siguiente la idea es que vayas copiando el c√≥digo y pegandolo en el script de R de tu sesi√≥n de RStudio y que lo vayas corriendo para ver qu√© sale.</p>
<p>El archivo de nuestra conversaci√≥n es de tipo <strong>CSV</strong> es decir una tabla con valores separados por comas (Comma-Separated Values). Este no es el √∫nico tipo de archivos que se pueden leer en R, <a href="https://www.datafiles.samhsa.gov/get-help/format-specific-issues/how-do-i-read-data-r">ac√°</a> puedes leer un poco sobre algunos de los archivos m√°s comunes que se pueden abrir en R.</p>
<p>Para leer nuestro chat, usaremos lo siguiente:</p>
<pre class="r"><code>chat &lt;- read.csv(&quot;wa_chat.csv&quot;)</code></pre>
<p>Si revisas el panel del ambiente, ver√°s que hay un objeto llamado chat, dale click ah√≠ para abrir la tabla que acabamos de cargar, revisala brevemente, notar√°s que en la tabla hay dos columnas, <code>persona</code> y <code>mensaje</code> ¬øte parece que los mensajes se leyeron correctamente?</p>
<p>Es probable que no, seguramente ver√°s algunos simbolos raros, quiz√° algunos de ellos est√°n en sitios donde deber√≠a haber una letra con acento. Esto ocurre justamente porque R no sabe muy bien c√≥mo interpretar los acentos, para leerlos correctamente tenemos que decirle c√≥mo <em>decodificarlos</em>, si cargamos los datos del siguiente modo corregiremos ese ‚Äúerror‚Äù:</p>
<pre class="r"><code>chat &lt;- read.csv(&quot;dequehablamos/wa_chat.csv&quot;, encoding = &quot;UTF-8&quot;)</code></pre>
<div id="un-primer-an√°lisis" class="section level4">
<h4>Un primer an√°lisis</h4>
<p>Algo que podemos intentar responder primero es, ¬øqui√©n ha enviado m√°s mensajes? Para responder esto haremos una tabla de frecuencias de la columna <code>persona</code>:</p>
<p><strong>N.B.</strong> Te sugiero revisar con detenimiento la forma en que <em>accedemos</em> a la columa deseada de la tabla.</p>
<pre class="r"><code>table(chat$persona)</code></pre>
<p>¬øCu√°l fue el resultado?, ¬øte lo esperabas?</p>
<p>Otra primera pregunta interesante ser√≠a ¬øqu√© tan largos son los mensajes que intercambiamos?, para ello primero crearemos una nueva columna (o variable) que tenga la cantidad de caract√©res de cada mensaje:</p>
<p><strong>N.B</strong> Nuevamente, te sugiero revisar detenidamente esta l√≠nea de c√≥digo con la intenci√≥n de desifrar c√≥mo est√° funcionando.</p>
<pre class="r"><code>chat$longitud_mensaje &lt;- nchar(chat$mensaje)</code></pre>
<p>Ahora podemos calcular algunas estad√≠sticas <em>resumen</em> de la longitud del mensaje:</p>
<pre class="r"><code>summary(chat$longitud_mensaje)</code></pre>
<p>¬øQu√© te parecen estos resultados?</p>
<p>Algo que a mi me llama la atenci√≥n es el valor m√°ximo de caract√©res en un mensaje, el cu√°l est√° muy por arriba del n√∫mero promedio de caract√©res que usamos.</p>
<p>¬øCu√°l ser√° ese mensaje y quien lo habr√° enviado?</p>
<p>Para determinar cu√°l es la <em>posici√≥n</em> del mensaje m√°s largo usamos lo siguiente:</p>
<pre class="r"><code>which.max(chat$longitud_mensaje)</code></pre>
<p>Ya que tengamos ese valor podemos encontrar a la persona que lo mand√≥ y al mensaje de la siguiente forma:</p>
<pre class="r"><code>chat$persona[aqu√≠_pones_el_n√∫mero_que_salio]
chat$mensaje[aqu√≠_pones_el_n√∫mero_que_salio]</code></pre>
<p>o bien:</p>
<pre class="r"><code>chat$persona[which.max(chat$longitud_mensaje)]
chat$mensaje[which.max(chat$longitud_mensaje)]</code></pre>
<p>Ok‚Ä¶</p>
<p>Ya sabemos qui√©n mand√≥ el mensaje m√°s largo, ¬øser√° que esa misma personas siempre manda mensajes largos?, para averiguarlo calcularemos la longitud promedio de los mensajes para cada persona:</p>
<p><strong>N.B</strong> Estas l√≠neas de c√≥digo pueden ser un poco m√°s complicadas, sin embargo la sintaxis es m√°s amigable al leerla, analiza con cuidado c√≥mo estamos haciendo el c√°lculo. Te platica adem√°s que estas funciones provienen del paquete <code>dplyr</code>.</p>
<pre class="r"><code>chat %&gt;% 
  group_by(persona) %&gt;% 
  summarise(longitud_promedio = mean(longitud_mensaje))</code></pre>
<p>¬øQui√©n tiende a mandar mensajes m√°s largos?, ¬øc√≥mo se relaciona este resultado con el anterior sobre qui√©n manda m√°s mensajes?</p>
<p>Modifica ese c√≥digo para calcular la mediana de la longitud del mensaje por persona, hagamos ese ejercicio tambi√©n calculando la longitud del mensaje m√°s peque√±o y el m√°s grande de cada persona.</p>
</div>
<div id="cu√°les-son-las-palabras-que-m√°s-usamos" class="section level4">
<h4>¬øCu√°les son las palabras que m√°s usamos?</h4>
<p>Ahora lo que haremos ser√° analizar los mensajes para obtener frecuencias por palabra y poder determinar si hay alguna palabra que usemos en mayor medida.</p>
<p>Para hacerlo usaremos funciones del paquete <code>tm</code>.</p>
<p>Lo primero ser√° crear un objeto de tipo <strong>Corpus</strong> (o corpora) b√°sicamente esto es un objeto que le dice a R que lo que est√° ah√≠ es <em>lenguaje natural</em> o lenguaje del que usamos las personas para comunicarnos:</p>
<pre class="r"><code>chat_corpus &lt;- Corpus(VectorSource(chat$mensaje))</code></pre>
<p>A continuaci√≥n lo que haremos ser√° limpiar esos textos, por ejemplo todo lo pondremos en may√∫sculas para que las palabras como <em>hola</em>, <em>Hola</em> y <em>HOLA</em> sean consideradas como la misma. Tambi√©n quitaremos los posibles n√∫meros que puedan aparecer pues como tal no son palabras y adicionalmente quitaremos signos de puntuaci√≥n pues tampoco es relevante saber cu√°les usamos.</p>
<p>Como siempre, te sugiero detenerte lo necesario para tratar de enteder lo que est√° haciendo el c√≥digo:</p>
<pre class="r"><code>chat_corpus &lt;- chat_corpus %&gt;% 
  tm_map(content_transformer(tolower)) %&gt;% 
  tm_map(content_transformer(removeNumbers)) %&gt;% 
  tm_map(content_transformer(removePunctuation))</code></pre>
<p>Muy bien, ahora lo que haremos es una matriz de t√©rminos, esto es una matriz que nos diga en qu√© mensajes se usa cada palabra identificada.</p>
<pre class="r"><code>chat_matrix &lt;- TermDocumentMatrix(chat_corpus)

chat_matrix &lt;- as.matrix(chat_matrix)</code></pre>
<p>Si en el ambiente le das click al objeto <code>chat_matrix</code> ver√°s que es una matriz algo rara, dificil de entender qu√© es lo que hay ah√≠.</p>
<p>Con el siguiente c√≥digo creamos una tabla de frecuencias de las palabras:</p>
<pre class="r"><code>tmp &lt;- sort(rowSums(chat_matrix), decreasing=TRUE)

chat_words &lt;- data.frame(word = names(tmp), freq = tmp)</code></pre>
<p>Si le das click al objeto <code>chat_words</code> podras ver la tabla de frecuencias ordenada de mayor a menor, ¬øte llama la atenci√≥n algo de esa tabla?, ¬øcrees que est√° <em>bien hecha</em>?</p>
<p>Antes de corregir algunos errores de esa tabla haremos una primera nube de palabras con esa informaci√≥n, la nube la haremos con un m√°ximo de 100 palabras:</p>
<pre class="r"><code>wordcloud(words = chat_words$word, freq = chat_words$freq, max.words = 100)</code></pre>
<p>¬°Perfecto!</p>
<p>O quiz√° no tanto, seguro habr√°s visto que algunas de las palabras m√°s frecuente son palabras que no fueron usadas como tal en la conversaci√≥n, otras de ellas son en realidad preposiciones, en el espa√±ol las preposiciones son muy usadas porque permiten ligar palabras para formar oraciones por lo tanto habr√° que quitar esas palabras de la conversaci√≥n para tratar de identificar de mejor forma las palabras que m√°s usamos.</p>
<p>¬øRecuerdas la parte de c√≥digo donde quitamos los n√∫meros y los signos de puntuaci√≥n? Te invito a agregarle a ese c√≥digo lo siguiente para quitar ahora lo que mencionamos.</p>
<pre class="r"><code>tm_map(removeWords, c(&quot;media&quot;, &quot;omitted&quot;)) %&gt;% 
  tm_map(removeWords, stopwords(&quot;spanish&quot;))</code></pre>
<p>Ahora podemos repetir el proceso de creaci√≥n de la tabla de frecuencias y de la nube de palabras:</p>
<pre class="r"><code>chat_matrix &lt;- TermDocumentMatrix(chat_corpus)

chat_matrix &lt;- as.matrix(chat_matrix)</code></pre>
<pre class="r"><code>tmp &lt;- sort(rowSums(chat_matrix), decreasing=TRUE)

chat_words &lt;- data.frame(word = names(tmp), freq = tmp)</code></pre>
<pre class="r"><code>wordcloud(words = chat_words$word, freq = chat_words$freq, max.words = 100)</code></pre>
<p>¬øQu√© tal se ve ahora?</p>
<p>Como ejercicio para que puedas practicar algunas cosas y empieces a perderle el miedo a R te dejo lo siguiente:</p>
<ul>
<li><p>Revisa c√≥mo puedes ponerle color a la nube de palabras, para esto te recomiendo revisar estos tutoriales:</p>
<ul>
<li><p><a href="http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know" class="uri">http://www.sthda.com/english/wiki/text-mining-and-word-cloud-fundamentals-in-r-5-simple-steps-you-should-know</a></p></li>
<li><p><a href="https://towardsdatascience.com/create-a-word-cloud-with-r-bde3e7422e8a" class="uri">https://towardsdatascience.com/create-a-word-cloud-with-r-bde3e7422e8a</a></p></li>
</ul></li>
<li><p>Repite el ejericio para crear una nube de palabras solamente con mis mensajes, ¬øcu√°les son las palabras que m√°s uso?</p></li>
<li><p>Repite el ejericio para crear una nube de palabras solamente con tus mensajes, ¬øcu√°les son las palabras que m√°s usas?</p></li>
</ul>
<p>Que te diviertas :)</p>
<p>Recuerda que puedes buscarme cuando sea y a la hora que sea por si necesitas ayuda.</p>
</div>
</div>
</div>
</div>
